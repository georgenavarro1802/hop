{% extends 'base.html' %}
{% load static %}

{% block heading %}
    <script>
        $("#works").addClass("active");

        $("#btn-search").click(function () {
            var search = $('#input-search').val();
            if (search){
                location.href = "{% url 'works' %}?s="+search;
            }
        });

        $('#input-search').keyup(function(e) {
            if(e.keyCode === 13) {
                $("#btn-search").trigger("click");
            }
        });

        $(".btn-notes").click(function () {
            var elem = $("#modal-notes");
            var code = $(this).attr('code');
            var notes = $(this).attr('notes');
            $('#modal-code').html("Code: " + code);
            $('#modal-text').html(notes);
            elem.modal('show');
            return false;
        });

        $("#modal-notes").find(".btn-close").click(function () {
           $("#modal-notes").modal('hide');
           return false;
        });



    </script>
{% endblock %}

{% block canvas %}
    <div class="container-fluid">

        <div class="row margin-row">

            <div class="col-sm-4">
                <p class="myheading"> <i class="fa fa-briefcase"></i> {{ title }}</p>
            </div>

            <div class="col-sm-4">
                <form class="form-inline">
                    <div class="form-group">
                        <label class="sr-only" for="search"></label>
                        <div class="input-group">
                            <input class="form-control" style="width: 300px; border-radius: 10px" id="input-search" placeholder="Search by code or address" value="{% if search %}{{ search }}{% endif %}">
                        </div>
                    </div>
                    <a id="btn-search" class="btn btn-success" title="Search"><i class="fa fa-search"></i></a>
                    {% if search %}<a href="{% url 'works' %}" class="btn btn-info" title="All"><i class="fa fa-list-alt"></i></a>{% endif %}
                </form>
            </div>

            {% if is_hotwire %}
                <div class="col-sm-4 text-right">
                    <a href="{% url 'works' %}?action=customer_reports" class="btn btn-warning" title="Chart"><i class="fa fa-bar-chart"></i> View Reports</a>
                </div>
            {% endif %}

        </div>

        <div class="row margin-row">
            <table class="table table-bordered table-hover">
                <thead>
                <tr style="font-weight: bold; font-size: 1em; background-color: #043b8a; color: white">
                    <th style="width: 60px">Cod.</th>
                    <th style="width: 220px">Project</th>
                    <th>Address</th>
                    {#                    {% if not is_hotwire %}#}
                    <th style="width: 120px">Customer</th>
                    {#                    {% endif %}#}
                    <th style="width: 100px" class="text-center">Date</th>
                    <th style="width: 70px" class="text-center">Start</th>
                    <th style="width: 70px" class="text-center">Register</th>
                    <th style="width: 70px" class="text-center">End</th>
                    <th style="width: 80px" class="text-center">Lead</th>
                    <th style="width: 40px" class="text-center">Status</th>
                    <th style="width: 20px"></th>
                </tr>
                </thead>
                <tbody>
                {% for w in works %}
                    <tr>
                        <td class="font12">
                            {{ w.repr_id }}
                            {% if w.notes %}
                                <a href="#" class="btn-notes btn btn-xs tr" title="Notes" notes="{{ w.notes }}" code="{{ w.repr_id }}">
                                    <i class="fa fa-sticky-note"></i>
                                </a>
                            {% endif %}
                        </td>
                        <td class="font12">
                            {{ w.project }}
                            {% if w.property %}
                                <br/><span class="font10">{{ w.property }}</span>
                            {% endif %}
                        </td>
                        <td class="font12">{{ w.address }}</td>
                        {#                        {% if not is_hotwire %}#}
                        <td class="font12">{{ w.customer.name }}</td>
                        {#                        {% endif %}#}
                        <td class="text-center font12">{{ w.date|date:'m-d-Y' }}</td>
                        <td class="text-center font12">{{ w.initial_time }}</td>
                        <td class="text-center font12">{{ w.register_time|default_if_none:'' }}</td>
                        <td class="text-center font12">{{ w.end_time|default_if_none:'' }}</td>
                        <td class="text-center font12">{{ w.leader|default_if_none:'' }}</td>
                        <td class="text-center font12">
                            {% if w.is_completed %}
                                <span class="label label-success">Completed</span>
                            {% else %}
                                <span class="label label-warning">Pending</span>
                            {% endif %}
                        </td>

                        <td>
                            <div class="btn-group">
                                <a class="font12 btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                                    Actions
                                    <span class="caret"></span>
                                </a>
                                <ul class="font12 dropdown-menu pull-right list-group">
                                    <li>
                                        <a href="{% url 'works' %}?action=details&id={{ w.id }}"><i class="fa fa-list"></i> Details</a>
                                    </li>
                                    {% if w.register_time and w.latitude_register and w.longitude_register %}
                                        <li>
                                            <a href="http://maps.google.com/?q={{ w.latitude_register }},{{ w.longitude_register }}" target="_blank">
                                                <i class="fa fa-globe"></i> Location
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if not w.is_completed %}
                                        <li><hr class="margin-10"/></li>
                                        {% if is_admin or is_dispatch %}
                                            <li>
                                                <a href="{% url 'works' %}?action=newteam&id={{ w.id }}"><i class="fa fa-user"></i> Reasign Reponsable</a>
                                            </li>
                                        {% endif %}
                                        <li>
                                            <a href="{% url 'works' %}?action=edit&id={{ w.id }}"><i class="fa fa-edit"></i> Edit</a>
                                        </li>
                                        <li>
                                            <a href="{% url 'works' %}?action=delete&id={{ w.id }}"><i class="fa fa-times"></i> Delete</a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="10" class="alert alert-info">
                            <i>There are not works in the system. Click in the <strong>+ Add Work</strong> button to add your first work</i>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>

            <div class="row">
                <div class="col-sm-6">
                    <a class="btn btn-success" href="{% url 'works' %}?action=add"><i class="fa fa-plus"></i> Add Work</a>
                </div>
                <div class="col-sm-6 text-right">
                    {% if paging.num_pages > 20 %}
                        <ul class="pagination">
                            {% if paging.first_page %}
                                <li><a href="{%  url 'works' %}?page=1{% if search %}&s={{ search }}{% endif %}">1</a></li>
                                <li><a href="{%  url 'works' %}?page={{ paging.ellipsis_left}}{% if search %}&s={{ search }}{% endif %}"
                                       class="active">...</a></li>
                            {% endif %}
                            {% for pagenumber in paging.pages %}
                                <li {% ifequal pagenumber page.number %}class='active'{% endifequal %}>
                                    <a href="{%  url 'works' %}?page={{ pagenumber }}{% if search %}&s={{ search }}{% endif %}">
                                        {{ pagenumber }}
                                    </a>
                                </li>
                            {% endfor %}
                            {% if paging.last_page %}
                                <li>
                                    <a href="{%  url 'works' %}?page={{ paging.ellipsis_right }}{% if search %}&s={{ search }}{% endif %}"
                                       class="active">
                                        ...
                                    </a>
                                </li>
                                <li>
                                    <a href="{%  url 'works' %}?page={{ paging.num_pages }}{% if search %}&s={{ search }}{% endif %}">
                                        {{ paging.num_pages }}
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    {% else %}
                        <ul class='pagination pagination-sm'>
                            {% for pagenumber in paging.page_range %}
                                <li {% ifequal pagenumber page.number %}class='active'{% endifequal %}>
                                    <a href="{%  url 'works' %}?page={{ pagenumber }}{% if search %}&s={{ search }}{% endif %}">
                                        {{ pagenumber }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
{% endblock %}

{% block moreblock %}
    <div class="modal fade in" id="modal-notes" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #3498db; color: white">
                    <h3 class="modal-title">
                        Work Notes
                        <span style="float: right; font-size: 1em" id="modal-code"></span>
                    </h3>
                </div>
                <div class="modal-body">
                    <p style="font-size: 1.2em; font-weight: 900">
                        Notes: <span id="modal-text" style="font-size: 0.8em; font-weight: normal"></span>
                    </p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-info btn-close" data-dismiss="modal"><i class="fa fa-close"></i> Close</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}